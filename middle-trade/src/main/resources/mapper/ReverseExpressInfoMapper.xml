<?xml version="1.0" encoding="UTF-8" ?>
<!--
  ~ Copyright (c) 2016 杭州端点网络科技有限公司, Code generated by terminus code gen
  -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="ReverseExpressInfo">
    <resultMap id="ReverseExpressInfoMap" type="ReverseExpressInfo">
        <id column="id" property="id"/>
        <result column="transfer_order_id" property="transferOrderId"/>
        <result column="carrier_code" property="carrierCode"/>
        <result column="carrier_name" property="carrierName"/>
        <result column="paid_after_delivery" property="paidAfterDelivery"/>
        <result column="line_no" property="lineNo"/>
        <result column="express_no" property="expressNo"/>
        <result column="sender_name" property="senderName"/>
        <result column="sender_mobile" property="senderMobile"/>
        <result column="has_order" property="hasOrder"/>
        <result column="instore_no" property="instoreNo"/>
        <result column="shop" property="shop"/>
        <result column="channel" property="channel"/>
        <result column="buyer_memo" property="buyerMemo"/>
        <result column="created_at" property="createdAt"/>
        <result column="out_created_at" property="outCreatedAt"/>
        <result column="updated_at" property="updatedAt"/>
        <result column="created_by" property="createdBy"/>
        <result column="updated_by" property="updatedBy"/>
        <result column="status" property="status"/>
        <result column="extra_json" property="extraJson"/>

    </resultMap>

    <sql id="tb">
        pousheng_reverse_express_info
    </sql>

    <sql id="cols_all">
        id,
        <include refid="cols_exclude_id"/>
    </sql>

    <sql id="cols_exclude_id">
        transfer_order_id, carrier_code, carrier_name, paid_after_delivery, line_no, express_no, sender_name, sender_mobile, has_order, instore_no, shop, channel, buyer_memo, created_at, updated_at, created_by, updated_by, status, extra_json,out_created_at
    </sql>

    <sql id="vals">
        #{transferOrderId}, #{carrierCode}, #{carrierName}, #{paidAfterDelivery}, #{lineNo}, #{expressNo}, #{senderName}, #{senderMobile}, #{hasOrder}, #{instoreNo}, #{shop}, #{channel}, #{buyerMemo}, now(), now(), #{createdBy}, #{updatedBy}, #{status}, #{extraJson},#{outCreatedAt}
    </sql>

    <sql id="express_vals">
        #{express.transferOrderId}, #{express.carrierCode}, #{express.carrierName}, #{express.paidAfterDelivery}, #{express.lineNo}, #{express.expressNo}, #{express.senderName}, #{express.senderMobile}, #{express.hasOrder}, #{express.instoreNo}, #{express.shop}, #{express.channel}, #{express.buyerMemo}, now(), now(), #{express.createdBy}, #{express.updatedBy}, #{express.status}, #{express.extraJson},#{express.outCreatedAt}
    </sql>

    <insert id="create" parameterType="ReverseExpressInfo" keyProperty="id" useGeneratedKeys="true">
        INSERT INTO
        <include refid="tb"/>
        (<include refid="cols_exclude_id"/>)
        VALUES
        (<include refid="vals"/>)
    </insert>

    <insert id="batchCreate" parameterType="java.util.List" keyProperty="id" useGeneratedKeys="true">
        INSERT INTO
        <include refid="tb" />
        (<include refid="cols_exclude_id" />)
        VALUES
        <foreach collection="list" item="express" index="index" separator=",">
            (<include refid="express_vals" />)
        </foreach>
        ON DUPLICATE KEY UPDATE
        carrier_code=VALUES(carrier_code),
        carrier_name=VALUES(carrier_name),
        paid_after_delivery=VALUES(paid_after_delivery),
        express_no=VALUES(express_no),
        sender_name=VALUES(sender_name),
        sender_mobile=VALUES(sender_mobile),
        has_order=VALUES(has_order),
        instore_no=VALUES(instore_no),
        shop=VALUES(shop),
        channel=VALUES(channel),
        buyer_memo=VALUES(buyer_memo),
        status=VALUES(status),
        extra_json=VALUES(extra_json),
        out_created_at=VALUES(out_created_at),
        updated_at=now()
    </insert>

    <select id="findById" parameterType="long" resultMap="ReverseExpressInfoMap">
        SELECT
        <include refid="cols_all"/>
        FROM
        <include refid="tb"/>
        WHERE id = #{id}
    </select>

    <select id="findReverseExpressInfoByExpressNo" parameterType="string" resultMap="ReverseExpressInfoMap">
        SELECT
        <include refid="cols_all"/>
        FROM
        <include refid="tb"/>
        WHERE express_no = #{expressNo}
    </select>

    <select id="findExpressByTransferAndLine" parameterType="map" resultMap="ReverseExpressInfoMap">
        SELECT
        <include refid="cols_all"/>
        FROM
        <include refid="tb"/>
        WHERE transfer_order_id = #{transferOrderId}
        and line_no = #{lineNo}
    </select>


    <sql id="criteria">
        <if test="id!=null">AND id=#{id}</if>
        <if test="transferOrderId!=null">AND transfer_order_id=#{transferOrderId}</if>
        <if test="carrierCode!=null">AND carrier_code=#{carrierCode}</if>
        <if test="carrierName!=null">AND carrier_name=#{carrierName}</if>
        <if test="expressNo!=null"> AND express_no=#{expressNo}</if>
        <if test="senderMobile!=null"> AND sender_mobile=#{senderMobile}</if>
        <if test="senderName!=null"> AND sender_name=#{senderName}</if>
        <if test="sender_mobile!=null"> AND refund_type=#{excludeRefundType}</if>
        <if test="instoreNo!=null"> AND instore_no=#{instoreNo}</if>
        <if test="shop !=null">AND shop =#{shop}</if>
        <if test="status!=null">AND
            status IN
            <foreach collection="status" open="(" separator="," close=")" item="s">
                #{s}
            </foreach>
        </if>
        <if test="startAt != null">AND <![CDATA[out_created_at >= #{startAt}]]> </if>
        <if test="endAt != null">AND <![CDATA[out_created_at < #{endAt}]]> </if>
        <if test="channel !=null">AND channel =#{channel}</if>
        <if test="has_order !=null">AND has_order=#{hasOrder}></if>
    </sql>

    <update id="update" parameterType="ReverseExpressInfo">
        UPDATE
        <include refid="tb"/>
        <set>
            <if test="transferOrderId != null">transfer_order_id = #{transferOrderId},</if>
            <if test="carrierCode != null">carrier_code = #{carrierCode},</if>
            <if test="carrierName != null">carrier_name = #{carrierName},</if>
            <if test="paidAfterDelivery != null">paid_after_delivery = #{paidAfterDelivery},</if>
            <if test="lineNo != null">line_no = #{lineNo},</if>
            <if test="expressNo != null">express_no = #{expressNo},</if>
            <if test="senderName != null">sender_name = #{senderName},</if>
            <if test="senderMobile != null">sender_mobile = #{senderMobile},</if>
            <if test="hasOrder != null">has_order = #{hasOrder},</if>
            <if test="instoreNo != null">instore_no = #{instoreNo},</if>
            <if test="shop != null">shop = #{shop},</if>
            <if test="channel != null">channel = #{channel},</if>
            <if test="buyerMemo != null">buyer_memo = #{buyerMemo},</if>
            <if test="createdBy != null">created_by = #{createdBy},</if>
            <if test="updatedBy != null">updated_by = #{updatedBy},</if>
            <if test="status != null">status = #{status},</if>
            <if test="extraJson != null">extra_json = #{extraJson},</if>

            updated_at=now()
        </set>
        WHERE id = #{id}
    </update>


    <select id="paging" parameterType="map" resultMap="ReverseExpressInfoMap">
        select id, <include refid="cols_exclude_id"/>
        from <include refid="tb"/>
        <where>
            <include refid="criteria"/>
        </where>
        order by id desc limit #{offset},#{limit}
    </select>

    <select id="count" parameterType="map" resultType="long">
        select count(1)
        from <include refid="tb"/>
        <where>
            <include refid="criteria"/>
        </where>
    </select>

</mapper>