<?xml version="1.0" encoding="UTF-8" ?>
<!--
  ~ Copyright (c) 2016 杭州端点网络科技有限公司, Code generated by terminus code gen
  -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="PoushengEspLog">
    <resultMap id="PoushengEspLogMap" type="PoushengEspLog">
        <id column="id" property="id"/>
        <result column="type" property="type"/>
        <result column="type_name" property="typeName"/>
        <result column="request_time" property="requestTime"/>
        <result column="request_content" property="requestContent"/>
        <result column="response_content" property="responseContent"/>
        <result column="stroe_code" property="stroeCode"/>
        <result column="stroe_name" property="stroeName"/>
        <result column="express_company_code" property="expressCompanyCode"/>
        <result column="express_no" property="expressNo"/>
        <result column="original_order_no" property="originalOrderNo"/>
        <result column="mpos_order_no" property="mposOrderNo"/>
        <result column="middle_shipment_no" property="middleShipmentNo"/>
        <result column="retry_num" property="retryNum"/>
        <result column="syn_status" property="synStatus"/>
        <result column="created_at" property="createdAt"/>
        <result column="updated_at" property="updatedAt"/>
        <result column="shipment_created_at" property="shipmentCreatedAt"/>
        <result column="shipment_updated_at" property="shipmentUpdatedAt"/>

    </resultMap>

    <sql id="tb">
        pousheng_esp_log
    </sql>

    <sql id="cols_all">
        id, <include refid="cols_exclude_id" />
    </sql>

    <sql id="cols_exclude_id">
        type, type_name, request_time, request_content, response_content, stroe_code, stroe_name, express_company_code, express_no, original_order_no, mpos_order_no, middle_shipment_no, retry_num, syn_status, created_at, updated_at, shipment_created_at, shipment_updated_at
    </sql>

    <sql id="vals">
        #{type}, #{typeName}, #{requestTime}, #{requestContent}, #{responseContent}, #{stroeCode}, #{stroeName}, #{expressCompanyCode}, #{expressNo}, #{originalOrderNo}, #{mposOrderNo}, #{middleShipmentNo}, #{retryNum}, #{synStatus}, now(), now(), #{shipmentCreatedAt}, #{shipmentUpdatedAt}
    </sql>

    <insert id="create" parameterType="PoushengEspLog" keyProperty="id" useGeneratedKeys="true">
        INSERT INTO
        <include refid="tb" />
        (<include refid="cols_exclude_id" />)
        VALUES
        (<include refid="vals" />)
    </insert>

    <select id="findById" parameterType="long" resultMap="PoushengEspLogMap" >
        SELECT <include refid="cols_all" />
        FROM <include refid="tb" />
        WHERE id = #{id}
    </select>

    <select id="findByCustom" parameterType="map" resultMap="PoushengEspLogMap">
        SELECT
        <include refid="cols_all"/>
        FROM
        <include refid="tb"/>
        <where>
            <if test="type != null">and type = #{type}</if>
            <if test="stroeCode != null">and stroe_code = #{stroeCode}</if>
            <if test="expressCompanyCode != null">and express_company_code = #{expressCompanyCode}</if>
            <if test="expressNo != null">and express_no = #{expressNo}</if>
            <if test="originalOrderNo != null">and original_order_no = #{originalOrderNo}</if>
            <if test="mposOrderNo">and mpos_order_no = #{mposOrderNo}</if>
            <if test="middleShipmentNo != null">and middle_shipment_no = #{middleShipmentNo}</if>
            <if test="synStatus != null">and syn_status = #{synStatus}</if>
            <if test="retryNum != null">and retry_num = #{retryNum},</if>
            <if test="createdAtStart != null"> <![CDATA[ and created_at >= #{createdAtStart} ]]> </if>
            <if test="createdAtEnd != null"> <![CDATA[ and created_at <= #{createdAtEnd} ]]> </if>
        </where>
    </select>

    <select id="findToRetryLog" parameterType="map" resultMap="PoushengEspLogMap">
        SELECT
        <include refid="cols_all"/>
        FROM
        <include refid="tb"/>
        <where>
            <if test="middleShipmentNo != null">and middle_shipment_no = #{middleShipmentNo}</if>
            <if test="synStatus != null">and syn_status = #{synStatus}</if>
            <if test="retryNum != null"><![CDATA[ and retry_num < #{retryNum} ]]></if>
            <if test="createdAtStart != null"> <![CDATA[ and created_at >= #{createdAtStart} ]]> </if>
            <if test="createdAtEnd != null"> <![CDATA[ and created_at <= #{createdAtEnd} ]]> </if>
        </where>
    </select>

    <select id="findByShipmentCode" parameterType="map" resultMap="PoushengEspLogMap">
        SELECT
        <include refid="cols_all"/>
        FROM
        <include refid="tb"/>
        <where>
            <if test="middleShipmentNo != null">and middle_shipment_no = #{middleShipmentNo}</if>
        </where>
        limit 1
    </select>

    <update id="update" parameterType="PoushengEspLog">
        UPDATE
        <include refid="tb"/>
        <set>
            <if test="type != null">type = #{type},</if>
            <if test="typeName != null">type_name = #{typeName},</if>
            <if test="requestTime != null">request_time = #{requestTime},</if>
            <if test="requestContent != null">request_content = #{requestContent},</if>
            <if test="responseContent != null">response_content = #{responseContent},</if>
            <if test="stroeCode != null">stroe_code = #{stroeCode},</if>
            <if test="stroeName != null">stroe_name = #{stroeName},</if>
            <if test="expressCompanyCode != null">express_company_code = #{expressCompanyCode},</if>
            <if test="expressNo != null">express_no = #{expressNo},</if>
            <if test="originalOrderNo != null">original_order_no = #{originalOrderNo},</if>
            <if test="mposOrderNo != null">mpos_order_no = #{mposOrderNo},</if>
            <if test="middleShipmentNo != null">middle_shipment_no = #{middleShipmentNo},</if>
            <if test="retryNum != null">retry_num = #{retryNum},</if>
            <if test="synStatus != null">syn_status = #{synStatus},</if>
            <if test="shipmentCreatedAt != null">shipment_created_at = #{shipmentCreatedAt},</if>
            <if test="shipmentUpdatedAt != null">shipment_updated_at = #{shipmentUpdatedAt},</if>

            updated_at=now()
        </set>
        WHERE id = #{id}
    </update>

    <delete id="delete" parameterType="long">
        DELETE FROM <include refid="tb"/>
        WHERE id = #{id}
    </delete>
</mapper>