<?xml version="1.0" encoding="UTF-8" ?>
<!--
  ~ Copyright (c) 2016 杭州端点网络科技有限公司, Code generated by terminus code gen
  -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="ReverseInstoreInfo">
    <resultMap id="ReverseInstoreInfoMap" type="ReverseInstoreInfo">
        <id column="id" property="id"/>
        <result column="instore_no" property="instoreNo"/>
        <result column="instore_detail_no" property="instoreDetailNo"/>
        <result column="erp_no" property="erpNo"/>
        <result column="platform_no" property="platformNo"/>
        <result column="carrier_express_no" property="carrierExpressNo"/>
        <result column="real_express_no" property="realExpressNo"/>
        <result column="in_flow_at" property="inFlowAt"/>
        <result column="accomplish_at" property="accomplishAt"/>
        <result column="arrive_wms_at" property="arriveWmsAt"/>
        <result column="status" property="status"/>
        <result column="channel" property="channel"/>
        <result column="shop" property="shop"/>
        <result column="created_at" property="createdAt"/>
        <result column="created_by" property="createdBy"/>
        <result column="updated_at" property="updatedAt"/>
        <result column="updated_by" property="updatedBy"/>
        <result column="extra_json" property="extraJson"/>
        <result column="customer_note" property="customerNote"/>
        
    </resultMap>

    <sql id="tb">
        pousheng_reverse_instore_info
    </sql>

    <sql id="cols_all">
        id, <include refid="cols_exclude_id" />
    </sql>

    <sql id="cols_exclude_id">
        instore_no, instore_detail_no, erp_no, platform_no, carrier_express_no, real_express_no, in_flow_at, accomplish_at, status, channel, shop, created_at, created_by, updated_at, updated_by, extra_json,arrive_wms_at,customer_note
    </sql>

    <sql id="vals">
        #{instoreNo}, #{instoreDetailNo}, #{erpNo}, #{platformNo}, #{carrierExpressNo}, #{realExpressNo}, #{inFlowAt}, #{accomplishAt}, #{status}, #{channel}, #{shop}, now(), #{createdBy}, now(), #{updatedBy}, #{extraJson},#{arriveWmsAt},#{customerNote}
    </sql>
    <sql id="instore_vals">
        #{instore.instoreNo}, #{instore.instoreDetailNo}, #{instore.erpNo}, #{instore.platformNo}, #{instore.carrierExpressNo}, #{instore.realExpressNo}, #{instore.inFlowAt}, #{instore.accomplishAt}, #{instore.status}, #{instore.channel}, #{instore.shop}, now(), #{instore.createdBy}, now(), #{instore.updatedBy}, #{instore.extraJson},#{instore.arriveWmsAt},#{instore.customerNote}
    </sql>

    <insert id="create" parameterType="ReverseInstoreInfo" keyProperty="id" useGeneratedKeys="true">
        INSERT INTO
        <include refid="tb" />
        (<include refid="cols_exclude_id" />)
        VALUES
        (<include refid="vals" />)
    </insert>

    <insert id="batchCreate" parameterType="java.util.List" keyProperty="id" useGeneratedKeys="true">
        INSERT INTO
        <include refid="tb" />
        (<include refid="cols_exclude_id" />)
        VALUES
        <foreach collection="list" item="instore" index="index" separator=",">
            (<include refid="instore_vals" />)
        </foreach>
        ON DUPLICATE KEY UPDATE
        erp_no=VALUES(erp_no),
        platform_no=VALUES(platform_no),
        carrier_express_no=VALUES(carrier_express_no),
        real_express_no=VALUES(real_express_no),
        in_flow_at=VALUES(in_flow_at),
        accomplish_at=VALUES(accomplish_at),
        status=VALUES(status),
        channel=VALUES(channel),
        shop=VALUES(shop),
        extra_json=VALUES(extra_json),
        customer_note=VALUES(customer_note),
        arrive_wms_at=VALUES(arrive_wms_at),
        updated_at=now()
    </insert>


    <select id="findById" parameterType="long" resultMap="ReverseInstoreInfoMap" >
        SELECT <include refid="cols_all" />
        FROM <include refid="tb" />
        WHERE id = #{id}
    </select>

    <select id="findReverseExpressInfoByInstoreNoAndDetailNo" resultMap="ReverseInstoreInfoMap">
        SELECT <include refid="cols_all" />
        FROM <include refid="tb" />
        WHERE
              instore_no = #{instoreNo}
        AND  instore_detail_no=#{instoreDetailNo}
    </select>


    <update id="update" parameterType="ReverseInstoreInfo">
        UPDATE
        <include refid="tb"/>
        <set>
            <if test="instoreNo != null">instore_no = #{instoreNo},</if>
            <if test="instoreDetailNo != null">instore_detail_no = #{instoreDetailNo},</if>
            <if test="erpNo != null">erp_no = #{erpNo},</if>
            <if test="platformNo != null">platform_no = #{platformNo},</if>
            <if test="carrierExpressNo != null">carrier_express_no = #{carrierExpressNo},</if>
            <if test="realExpressNo != null">real_express_no = #{realExpressNo},</if>
            <if test="inFlowAt != null">in_flow_at = #{inFlowAt},</if>
            <if test="accomplishAt != null">accomplish_at = #{accomplishAt},</if>
            <if test="status != null">status = #{status},</if>
            <if test="channel != null">channel = #{channel},</if>
            <if test="shop != null">shop = #{shop},</if>
            <if test="createdBy != null">created_by = #{createdBy},</if>
            <if test="updatedBy != null">updated_by = #{updatedBy},</if>
            <if test="extraJson != null">extra_json = #{extraJson},</if>
            <if test="customerNote != null">customer_note = #{customerNote},</if>
            <if test="arriveWmsAt != null">arrive_wms_at = #{arriveWmsAt},</if>

            updated_at=now()
        </set>
        WHERE id = #{id}
    </update>



    <sql id="criteria">
        <if test="id!=null">AND id=#{id}</if>
        <if test="instoreNo!=null">AND instore_no=#{instoreNo}</if>
        <if test="instoreDetailNo!=null"> AND instore_detail_no=#{instoreDetailNo}</if>
        <if test="platformNo!=null">AND platform_no=#{platformNo}</if>
        <if test="channel !=null">AND channel =#{channel}</if>
        <if test="shop !=null">AND shop =#{shop}</if>
        <if test="carrierExpressNo!=null">AND carrier_express_no=#{carrierExpressNo}</if>
        <if test="realExpressNo!=null"> AND real_express_no=#{realExpressNo}</if>
        <if test="unique_no!=null"> AND unique_no=#{uniqueNo}</if>
        <if test="relateAsn!=null"> AND relate_asn=#{relateAsn}</if>
        <if test="customerNote!=null"> AND customer_note like concat('%',#{customerNote},'%')</if>
        <if test="erpNo != null">AND erp_no = #{erpNo}</if>
        <if test="status!=null">AND
            status IN
            <foreach collection="status" open="(" separator="," close=")" item="s">
                #{s}
            </foreach>
        </if>
        <if test="startAt != null">AND <![CDATA[created_at >= #{startAt}]]> </if>
        <if test="endAt != null">AND <![CDATA[created_at <= #{endAt}]]> </if>

        <if test="arriveWmsStartAt != null">AND <![CDATA[arrive_wms_at >= #{arriveWmsStartAt}]]> </if>
        <if test="arriveWmsEndAt != null">AND <![CDATA[arrive_wms_at <= #{arriveWmsEndAt}]]> </if>
    </sql>


    <select id="paging" parameterType="map" resultMap="ReverseInstoreInfoMap">
        select id, <include refid="cols_exclude_id"/>
        from <include refid="tb"/>
        <where>
            <include refid="criteria"/>
        </where>
        order by id desc limit #{offset},#{limit}
    </select>

    <select id="count" parameterType="map" resultType="long">
        select count(1)
        from <include refid="tb"/>
        <where>
            <include refid="criteria"/>
        </where>
    </select>
</mapper>