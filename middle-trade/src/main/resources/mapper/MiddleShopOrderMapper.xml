<?xml version="1.0" encoding="UTF-8" ?>
<!--
  ~ Copyright (c) 2016 杭州端点网络科技有限公司, Code Generated by terminus code gen
  -->

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="MiddleShopOrder">
    <resultMap id="MiddleShopOrderMap" type="MiddleShopOrder">
        <id column="id" property="id"/>
        <result column="shop_id" property="shopId"/>
        <result column="buyer_id" property="buyerId"/>
        <result column="fee" property="fee"/>
        <result column="status" property="status"/>
        <result column="type" property="type"/>
        <result column="buyer_name" property="buyerName"/>
        <result column="out_buyer_id" property="outBuyerId"/>
        <result column="shop_name" property="shopName"/>
        <result column="out_shop_id" property="outShopId"/>
        <result column="company_id" property="companyId"/>
        <result column="referer_id" property="refererId"/>
        <result column="referer_name" property="refererName"/>
        <result column="origin_fee" property="originFee"/>
        <result column="discount" property="discount"/>
        <result column="ship_fee" property="shipFee"/>
        <result column="origin_ship_fee" property="originShipFee"/>
        <result column="integral" property="integral"/>
        <result column="balance" property="balance"/>
        <result column="promotion_id" property="promotionId"/>
        <result column="shipment_type" property="shipmentType"/>
        <result column="pay_type" property="payType"/>
        <result column="channel" property="channel"/>
        <result column="has_refund" property="hasRefund"/>
        <result column="commented" property="commented"/>
        <result column="buyer_note" property="buyerNote"/>
        <result column="extra_json" property="extraJson"/>
        <result column="tags_json" property="tagsJson"/>
        <result column="out_id" property="outId"/>
        <result column="out_from" property="outFrom"/>
        <result column="system_auto_expired_at" property="systemAutoExpiredAt"/>
        <result column="commission_rate" property="commissionRate"/>
        <result column="distribution_rate" property="distributionRate"/>
        <result column="diff_fee" property="diffFee"/>
        <result column="out_created_at" property="outCreatedAt"/>
        <result column="created_at" property="createdAt"/>
        <result column="updated_at" property="updatedAt"/>
        <result column="mobile" property="mobile"/>
    </resultMap>
    <sql id="tb">
        parana_shop_orders pso LEFT JOIN parana_order_receiver_infos pori on pso.id = pori.order_id
    </sql>
    <sql id="criteria">
        <if test="status != null">AND pso.status IN
            <foreach collection="status" open="(" separator="," close=")" item="st">
                #{st}
            </foreach>
        </if>
        <if test="id!=null">AND pso.id =#{id}</if>
        <if test="buyerId != null">AND pso.buyer_id = #{buyerId}</if>
        <if test="buyerName != null">AND pso.buyer_name = #{buyerName}</if>
        <if test="shopId!=null">AND pso.shop_id=#{shopId}</if>
        <if test="shopIds != null">AND pso.shop_id IN
            <foreach collection="shopIds" open="(" separator="," close=")" item="shopId">
                #{shopId}
            </foreach>
        </if>
        <if test="type != null">AND pso.type = #{type}</if>
        <if test="companyId != null">AND pso.company_id = #{companyId}</if>
        <if test="refererId != null">AND pso.referer_id = #{refererId}</if>
        <if test="outId != null">AND pso.out_id = #{outId}</if>
        <if test="mobile != null">AND pori.mobile = #{mobile}</if>
        <if test="hasRefund != null">AND pso.has_refund = #{hasRefund}</if>
        <if test="startAt != null">AND <![CDATA[pso.created_at >= #{startAt}]]> </if>
        <if test="endAt != null">AND <![CDATA[pso.created_at <= #{endAt}]]> </if>
        <if test="updateStartAt != null">AND <![CDATA[pso.updated_at >= #{updateStartAt}]]> </if>
        <if test="updateEndAt != null">AND <![CDATA[pso.updated_at <= #{updateEndAt}]]> </if>
        <if test="outCreatedStartAt != null">AND <![CDATA[pso.out_created_at >= #{outCreatedStartAt}]]> </if>
        <if test="outCreatedEndAt != null">AND <![CDATA[pso.out_created_at <= #{outCreatedEndAt}]]> </if>
    </sql>
    <sql id="cols_exclude_id">
         pso.shop_id,pso.buyer_id,pso.fee,pso.status,pso.type,pso.buyer_name,pso.out_buyer_id,pso.shop_name,pso.out_shop_id,pso.company_id,pso.referer_id,pso.referer_name,
         pso.origin_fee,pso.discount,pso.ship_fee,pso.origin_ship_fee,pso.integral,pso.balance,
         pso.shipment_type,pso.pay_type,pso.channel,pso.has_refund,pso.commented,pso.buyer_note,pso.extra_json,pso.tags_json,pso.out_id,
         pso.out_from, pso.system_auto_expired_at, pso.commission_rate,pso.distribution_rate,pso.diff_fee,pso.out_created_at,pso.created_at,pso.updated_at,pori.mobile
    </sql>

    <select id="paging" parameterType="map" resultMap="MiddleShopOrderMap">
        select pso.id,
        <include refid="cols_exclude_id"/>
        from
        <include refid="tb"/>
        <where>
            <include refid="criteria"/>
        </where>
        order by `id` desc
        limit #{offset}, #{limit}
    </select>
    <select id="count" parameterType="map" resultType="long">
        select count(1) from
        <include refid="tb"/>
        <where>
            <include refid="criteria"/>
        </where>
    </select>

</mapper>